---
tags:
  - general-ad-play-platform
---
# 通用廣告推播平台 - 架構設計

## \[架構目標\]

- 不同場域 (EX: 便利商店、超商、銀行、門市、巴士車體)

- 配合以下動作: 

   - 安裝好 Digital Signage + CMS 服務，CMS 與平台對接

   - 安裝我們方案的感測器(AI Camera, Beacon, GPS,  Edge LLM) 

   - 設定好場域初始配置

- 享受成果: 分析報告、線上報表、播放推薦

- 新感測器種類的數據處理與分析流程，需要預先處理完後才能整合分析



二、功能需求 (Functional Requirements)

感測器資料接收與篩理

廣告素材上傳與元資訊編譯

觀看行為分析與場域行為報告

廣告推薦機制：執行標籤化策略推播

推播內容排程與CMS互連

加值功能：價值揭示與優惠發送

三、非功能需求 (Non-functional Requirements)

性能：1s 內推薦結果，CMS連線在 3s 內啟動播放

安全：網路通信 HTTPS、Azure AD 認證

相容性：支援 3 種主要 CMS API 種類

可用性：系統 uptime 目標 99.5%

## \[工具/服務清單\]  

- Databricks:  所有數據分析處理流程

- Databricks Dashboard: 分析報表

- 應用系統 Server: Azure App Service

- 權限管理: Azure AD

- 後端: [ASP.NET](http://ASP.NET) Core (.NET 8)

- 資料庫: Azure SQL

- 前端: Vue3

- Azure De



## \[架構概要\]

### ▋ 架構原則

1. 核心抽象化（Core Abstraction）

   - 場域（Venue）：定義場域ID、類型、位置

   - 感測器（Sensor）：定義感測器ID、類型、安裝位置

   - 受眾輪廓（Audience Profile）：觀看行為特徵與指標

   - 內容單元（Content Unit）：標籤化廣告素材

   - 觸發條件（Trigger Condition）：廣告推播規則

   - 推播策略（Push Strategy）：內容推薦與排序方法

   - 廣告解析資訊

2. 配置驅動（Configuration Driven）

   - 將場域邏輯、規則、模型選擇抽離為設定檔，易於擴展與維護

   - 使用中央配置中心（Azure SQL 或 Cosmos DB）儲存所有場域與規則設定

3. API 優先: 各層間透過標準化API溝通，確保模組可插拔與擴充性

4. CMS 適配器模式: 不同終端播放器適配器



## \[主要挑戰與暫定方向\]

- 系統整合的複雜性雖然具挑戰，但也構成未來的數據產品競爭壁壘。

- 初期以全家為基礎進行簡化設計，同時適當考量未來通用場景需求。

### ▋感測器數據的多樣性與格式標準化

- 可能問題：統一為單一 JSON Schema 的理想，在實務上可能因感測器數據的多樣性而難以實現，導致資料內容（payload）複雜化或需要多種不同 Schema。

- 暫定：以智慧建築的資料格式為參考，優先處理 AI Camera、Beacon、巴士 GPS 等主要感測器數據，並逐步納入其他零售場景常用感測器（如紅外線偵測、地墊踩踏）。

### ▋現有 CMS 整合的挑戰

- 可能問題：現有 CMS 的 API 缺乏或不一致，難以直接整合。

- 暫定規劃：先從 AUO 的三個 CMS 系統入手，取得主要播放結果的資料表（DB Table Schema），進行初步整合規劃。

### ▋不同場域配置管理的複雜性

- 可能問題：隨著場域、感測器及規則的增加，配置管理可能複雜化且容易出錯。

- 暫定規劃：以「場域類型」、「區域」或特定分析結果作為配置管理分類標準，以簡化管理難度。

### ▋多種感測器數據的整合分析

- 可能問題：多感測器數據整合與分析存在難度，影響內容推薦精準度。

- 暫定規劃：建立以「受眾輪廓」為核心的數據抽象模型，先行訂定初步的特徵分類規則。





## \[主要模組\]

### ▋感測器接收清理模組

- **輸入**: 統一的 JSON Schema 接收格式的感測器數據

- **主流程**: 

   - 針對不同感測器類型(AI Camera、Beacon、GPS等)的專屬數據清理pipeline

   - 標準化時間戳記與場域識別

   - 數據質量檢查與異常值處理

- **輸出**: 符合統一Audience Profile 結構的銀級數據表



### ▋CMS串接模組 (適配器模式)

- **輸入**: 推播排程指令、廣告內容資料

- **主流程**:

   - CMS系統類型識別與API調用準備

   - 排程指令轉換為對應CMS格式

   - 串接狀態監控與錯誤處理

   - 播放結果回饋收集

- **輸出**: CMS系統專屬API呼叫、播放狀態回報



### ▋廣告解析模組

- **輸入**: 廣告Meta資訊、廣告素材影像檔、廣告文案

- **主流程**:

   - 廣告內容特徵提取(品類、情境、氛圍等)

   - 素材標籤化處理

   - 適用場域類型與時段判定

   - 目標受眾適配性分析

- **輸出**: 結構化的廣告資訊Table，包含標籤、適用場景與目標受眾



### ▋分析模組

- **輸入**: 統一Audience Profile數據表、構化的廣告資訊Table、場域配置資訊

- **主流程**: 

   - 場域人流與停留行為分析

   - 觀看時段與區域分布趨勢

   - 多感測器數據融合與交叉驗證

   - 受眾輪廓分群與特徵摘要

- **輸出**: 場域分析報表、受眾行為洞察、趨勢指標Table



### ▋廣告推薦模組

- **輸入**: 受眾輪廓數據、場域即時狀態、廣告內容庫

- **主流程**:

   - 從配置中心讀取場域觸發規則(Trigger Condition)

   - 根據規則引擎判斷當前場景是否符合觸發條件

   - 匹配適合的廣告內容和推播策略

   - 應用推薦演算法排序內容單元

- **輸出**: 針對特定場域/時段/受眾的廣告推薦列表與優先級



### ▋推播排程模組

- **輸入**: 廣告推薦列表、CMS系統容量與排程約束

- **主流程**:

   - 基於場域類型的排程策略應用

   - 推播時機最佳化(避開高峰或選擇高峰)

   - 內容輪替管理與展示頻率控制

   - 排程衝突處理與優先權調度

- **輸出**: 結構化的播放排程表，含時間點、顯示設備、內容ID與播放持續時間



### ▋優惠發送模組

- **輸入**: 即時觸發事件、相關受眾輪廓、推薦優惠內容

- **主流程**:

   - 基於場域類型選擇發送管道(螢幕、推播通知等)

   - 優惠券或促銷資訊格式化

   - 發送時機精準控制

   - 優惠反饋追蹤機制

- **輸出**: 發送紀錄表，包含發送時間、管道、優惠ID、目標對象與互動狀態

## \[關鍵整合點\]

- **配置中心(Configuration Hub)**: 中央資料庫存儲所有模組運作所需的場域配置、規則設定與模型對應

- **統一Audience Profile**: 核心資料格式，連結感測器原始資料與高階應用層邏輯

- **規則引擎服務**: 處理複雜的條件判斷邏輯，使業務規則與技術實現解耦


