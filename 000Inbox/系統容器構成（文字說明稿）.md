# 系統容器構成（文字說明稿）

## 圖面概覽

此圖以「資料流」為主軸，分成四個區帶與兩條應用線：

- 上方依雲端服務標示主要托管：**AWS S3、AWS Fargate、Databricks、AWS Services、AWS RDS**。

- 中段依職能分為：**擷取層 → 數據中心 → 應用層**。

- 右半部有兩條應用線：**VMS（內部經銷端）**、**FMS（客戶／車隊端）**。

- 左側 **External** 來源包含 **DMS** 與 **T-box**。

---

## 元件與職責

### External 資料來源

- **DMS**：經銷商管理系統，提供業務／車輛主檔等權威資料。

- **T-box**：車載傳輸裝置，上送 CAN/感測資料。

### 擷取層（Inbound）

- **Firewall**：入口防護，阻擋未授權流量。

- **API Gateway（Verify Key）**：驗證 API 金鑰／簽章，統一流量進入點。

- **Data Receive（[ASP.NET](http://ASP.NET)）**：接收同步請求（REST/HTTPS），做基本校驗與排程觸發。

- **Streaming Service（AWS Kinesis）**：承接高頻資料流，解耦峰值。

- **Data Decode（[ASP.NET](http://ASP.NET)）**：對原始封包／欄位做解碼、初步標準化。

### 數據中心（Data Lake / Jobs）

- **AWS S3**：原始與清理後資料的主要儲存。

- **Delta Table in AWS S3**：以 Delta Lake 管理的結構化資料表（支援快照、ACID）。

- **存封 AWS S3**：長期歸檔／冷存取。

- **Data Center Jobs（Databricks / Jobs）**：批次與近即時作業（清理、對齊、彙整、指標計算）。

### 應用層（VMS / FMS）

共用樣式，各自獨立部署：

- **Backend（[ASP.NET](http://ASP.NET)）**：網域邏輯與 API。

- **PostgreSQL（AWS RDS）**：應用資料庫（設定、報表彙總、用戶資料等）。

- **Dashboard Data Process（Python）**：儀表板用派生計算（指標、快照、匯出）。

- **Frontend（Vue.js）**：前端介面（VMS 與 FMS 各自的使用情境與權限）。

---

## 端到端資料流程（一步步）

1. **T-box / DMS** 透過 **Firewall → API Gateway** 進入平台，完成金鑰驗證與限流。

2. 同步請求由 **Data Receive（[ASP.NET](http://ASP.NET)）** 接收；高頻資料走 **Kinesis**，形成可彈性伸縮的擷取管線。

3. **Data Decode（[ASP.NET](http://ASP.NET)）** 將原始封包解碼、欄位標準化，寫入 **AWS S3**（Bronze）。

4. **Databricks Jobs** 從 **AWS S3** 取數，完成清洗／對齊／去重／結構化，產出 **Delta Table**（Silver/Gold），同時將舊資料歸檔到 **存封 S3**。

5. 作業產出供應兩條應用線：

   - 寫入或匯總到 **PostgreSQL（VMS）**，提供經銷端營運／維保分析。

   - 寫入或匯總到 **PostgreSQL（FMS）**，提供車隊端監控／營運可視化。

6. **Backend（[ASP.NET](http://ASP.NET)）** 對外提供 API 與後台管理；**Dashboard Data Process（Python）** 產出報表/指標；**Frontend（Vue.js）** 呈現儀表板與操作介面。

---

## 安全與治理重點

- **邊界防護**：Firewall 於最外層，**API Gateway** 負責金鑰驗證、權杖檢查、速率限制。

- **資料分層**：S3/Delta 採 **Bronze → Silver → Gold**，支援追溯與審計。

- **解耦設計**：Kinesis 緩衝尖峰、Jobs 與應用層解耦，降低彼此影響。

- **環境隔離**：VMS 與 FMS 獨立後端與資料庫，權限、負載與變更各自治理。

---

## 可寫入文件的簡短摘要（可貼在章節開頭）

> 本系統的 C2 容器構成以 AWS 為核心：資料由 DMS 與車載 T-box 經 **Firewall / API Gateway** 驗證後進入，透過 **[ASP.NET](http://ASP.NET)** 接收與 **Kinesis** 串流解耦，經 **Data Decode** 標準化後寫入 **S3**。**Databricks Jobs** 在 S3/Delta 上完成清洗與彙總，並分別供給 **VMS 與 FMS** 的應用棧（**[ASP.NET](http://ASP.NET) Backend + RDS PostgreSQL + Python Dashboard Process + Vue.js 前端**）。整體以分層儲存、流批解耦與環境隔離為原則，確保擴充性、可維運性與安全治理。