# Medallion Architecture 金銀銅架構問題

## **先談一下傳統資料倉儲**

![image 186.png](./Medallion%20Architecture%20金銀銅架構問題%201-assets/image%20186.png)

---

![image 187.png](./Medallion%20Architecture%20金銀銅架構問題%201-assets/image%20187.png)

1️⃣ Data Warehouse 的目的

資料倉儲是為了 **分析（OLAP）而設計**，和交易系統（OLTP）不同。

- OLTP → 保證資料正確、結構正規化

- OLAP → 讀取量巨大 → 重點是「讀取速度」

- 為了加速分析常會用 大表、反正規化、寬表、Star Schema

關鍵：分析系統可以重複資料，只要讀快就好。

---

### 2️⃣ 資料進入倉儲的流程

#### 🚧 (1) 抽取 → Staging（落地層）

資料先從來源系統抽出來，放到 staging

- 來源格式不一致（API、DB、file）→ 抽取很複雜

- Staging 可能保留大量歷史版本

- 這裡不做分析，只負責先拿資料

Staging 就是所有 ETL / ELT 的入口層

---

#### 🔧 (2) 整合 → Integration Layer（清洗與標準化）

在這裡進行：

- 清洗（cleaning）

- 格式與欄位標準化

- key mapping

- master data

- 多來源整合

- 歷史版本處理（SCD）

這一步的核心是：把資料變成「可以分析」的統一格式。

不論你是舊的數倉或新的 Lakehouse，都隱藏不了這段 transformation。

---

#### 📊 (3) 呈現 → Presentation Layer（分析模型 / Data Marts）

這層是給「真正做分析的人」使用的。

常見形式：

- Star Schema（維度表 + 事實表）

- 寬表、聚合表

- Data Marts（分析資料集）

重點：**這一層會針對讀取效能最佳化，也會針對使用者情境調整模型。**

![image 188.png](./Medallion%20Architecture%20金銀銅架構問題%201-assets/image%20188.png)





## 維度表概念

- Fact Table: 實際的活動數據，一直堆積，例如: 內容播放數據、車子經緯度、Camera 觀看數據

- SCD（Slowly Changing Dimensions）: 

   - 店的名稱跟位置 ( 有新的店才會新增一筆)

   - 車子的基本資訊 (  有賣出去才會新增 )

   - AI Camera 規格資訊 ( 有安裝才會新增 )



---

### ⭐ **Star Schema** 一致性維度（Conformed Dimensions）

**Star Schema = 維度表 + 事實表**

Kimball 為了讓不同報表、不同部門的資料可以彼此對得起來，引入「**一致性維度**」。 意思是：**大家共享同一份維度表（如時間、地點、產品）。** 這樣所有分析結果都能一致、不會各講各的。

---

### ⭐ 慢慢變化維度（SCD）：用來記錄資料的歷史變化

SCD（Slowly Changing Dimensions）是用來保存「維度資料歷史」的技巧。 

簡單說：某些資料會改變（例如顧客地址、店長、分類名稱），SCD 就是記怎麼存這些變化。

最常用的三種：

---

### **SCD1 — 直接覆蓋（Overwrite）**

- **舊資料直接被新資料蓋掉**

- 不保留歷史

- 適合「只看最新狀態」的情境 例：商品名稱改了 → 直接改過去，舊名稱不記錄。

---

### **SCD2 — 新增一筆（Add New Row）**

- **每次變更都新增一行資料 → 保留完整歷史**

- 常會有「生效日期」、「是否為目前版本」等欄位

- 適合需要追歷史的情境 例：客戶換地址 → 新增一筆資料，舊地址那筆保留但標記為已失效。

---

### **SCD3 — 增加新欄位（Add New Attribute）**

- 在同一筆資料裡**另外加欄位**記錄「前一個狀態」

- **只能記有限的歷史（通常只有一個 previous value）**

- 適合變動很少、歷史需求不高的情境 例：只想記「目前分類」＋「上一個分類」。









## 換到大數據 Data Lake 數據架構

---

**第一層：資料來源層**
這一層就是所有「把資料產生出來」的系統與設備。
來源可能來自不同公司、不同格式（CSV、JSON、Database、API）、不同頻率（批次或串流）。
重點：**資料非常雜、分散、格式不一致。**

---

**第二層：資料傳遞與整合平台層**
這一層負責「把資料運進來、整合起來」的工具組合。
因為市面上工具太多（ETL、ELT、Spark、Airflow、Kafka、Fivetran、DBT…），企業必須在數百種方案中選擇。
重點：**整合技術很複雜，工具多到爆，架構決策難度高。**

---

**第三層：資料消費與應用層**
這層是「用資料創造價值」的地方。
包含商業智慧（BI 報表）、機器學習、AI 模型、即時分析、推薦、預測等服務。
也包含比較底層的存取、查詢、資料處理 API。
重點：**每個商業問題都需要不同的技術組合，因此這層的技術種類最多。**

---

如果你想，我也可以幫你畫成一張你工作上常用的「資料平台三層示意圖」（偏 Databricks/Lakehouse 風格）。

![image 189.png](./Medallion%20Architecture%20金銀銅架構問題%201-assets/image%20189.png)







## 主題: Medallion architecture

- **核心定義：** 這是一種數據設計模式，主要用於 **Lakehouse (湖倉一體)** 架構中，用來對數據進行邏輯化的組織與分類。

- **分層結構：** 採用 **三層式架構** 來建構數據平台。

- **主要目標：** **漸進式地 (incrementally and progressively)** 持續改善數據的結構與品質。

- **數據流向：** 數據會依序流經架構中的每一層，品質隨之提升：

   - 從 **Bronze (銅級)** >  **Silver (銀級)**  > **Gold (金級)**。

![image 190.png](./Medallion%20Architecture%20金銀銅架構問題%201-assets/image%20190.png)



![image 191.png](./Medallion%20Architecture%20金銀銅架構問題%201-assets/image%20191.png)



### 舉例

- 便利商店收回一堆「原始交易紀錄」：有缺欄位、格式不一、還混著錯誤資料。這些先放在 **銅表（Bronze）**，完全不動，純接資料。

- 你開始把錯誤資料剔除、把時間格式統一、把商品編號轉成可讀名稱，這些「整理好的乾淨資料」就是 **銀表（Silver）**。

- 你依照業主要的報表，把資料彙總成「每日銷售額」、「熱門商品排行」等可直接查詢的指標，這就是 **金表（Gold）**。

- 銅 → 銀 → 金，就是「接進來 → 清理好 → 能用來決策」的過程。



### Why:

- 提供情境(Context)，告訴使用數據的人

- 這份資料現在處於什麼狀態？ 它乾淨嗎？ 我可以放心用它來做決策嗎？

- 讓數據帶有履歷的資訊，你知道它從哪來，經過了什麼處理，現在準備好做什麼用途。

- 重跑能力（Reproducibility）與容錯：

   - 假設你在 Silver Layer 的清洗邏輯有 Bug，且已經跑了半年

   - 因保留 Bronze，可以修改 Silver 的程式碼，從 Bronze 重新回放（Replay/Backfill）過去半年的數據，修復錯誤。


